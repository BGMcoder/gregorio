%GregorioTeX file.
%Copyright (C) 2007 Elie Roux <elie.roux@telecom-bretagne.eu>
%
%This program is free software: you can redistribute it and/or modify
%it under the terms of the GNU General Public License as published by
%the Free Software Foundation, either version 3 of the License, or
%(at your option) any later version.
%
%This program is distributed in the hope that it will be useful,
%but WITHOUT ANY WARRANTY; without even the implied warranty of
%MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%GNU General Public License for more details.
%
%You should have received a copy of the GNU General Public License
%along with this program.  If not, see <http://www.gnu.org/licenses/>.

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{gregoriotex}%
    [2014/05/16 v2.4 GregorioTeX system.]
\RequirePackage{xcolor}

\input gregoriotex.tex

% we hide lines only under LaTeX
\Gre@HideAltLines
\Gre@HidePCLines


%%%%%%%%%%%%%%
%	Color definitions	%
%%%%%%%%%%%%%%

\definecolor{grebackgroundcolor}{RGB}{255,255,255}%
\definecolor{gregoriocolor}{RGB}{229,53,44}


%%%%%%%%%%%%%%%%%%%%%%
%	Environments for Score elements	%
%%%%%%%%%%%%%%%%%%%%%%

\def\gre@initialformat#1{%
  \begin{initialformat}#1\end{initialformat}%
  \relax %
}
\newenvironment*{initialformat}{\begin{huge}}{\end{huge}
	

\def\gre@biginitialformat#1{%
  \begin{biginitialformat}#1\end{biginitialformat}%
  \relax %
}
\newenvironment*{biginitialformat}{\begin{Huge}}{\end{Huge}}


\def\gre@abovelinestextstyle#1{%
  \begin{abovelinetextstyle}#1\end{abovelinetextstyle}%
  \relax %
}
\newenvironment{abovelinetextstyle}{\begin{textit}\begin{small}}{\end{small}\end{textit}}

\def\gre@translationformat#1{%
	\begin{translationformat}#1\end{translationformat}%
	\relax%
}
\newenvironment{translationformat}{\begin{textit}}{\end{textit}}

\def\gre@normalstafflinesformat#1{%
	\begin{normalstafflinesformat}#1\end{normalstafflinesformat}%
	\relax%
}
\newenvironment{normalstafflinesformat}{\relax}{}

\def\gre@additionalstafflinesformat#1{%
	\begin{additionalstafflinesformat}#1\end{additionalstafflinesformat}%
	\relax%
}
\newenvironment{additionalstafflinesformat}{\begin{normalstafflinesformat}}{\end{normalstafflinesformat}}

\def\GreSetStaffLinesFormat#1{%
	\gre@warning{\protect\GreSetStaffLinesFormat\space is deprecated.  Manipulate the normalstafflinesformat environment instead.}
	\renewenvironment{normalstafflinesformat}{#1}{}%
	\relax %
}


%%%%%%%%%%%%%%%%%%%%%%%%%
%	Commands to color elements of score	%
%%%%%%%%%%%%%%%%%%%%%%%%%

\def\grecolored#1{
  {%
    \color{gregoriocolor}#1%
  }%
}
\newcommand*{\colored}{}
\let\colored\grecolored

\def\gre@coloredlines#1{%
  \Gre@SetStaffLinesFormat{%
  \color{#1}%
  }%  
  \relax %
}
\newcommand*{\coloredlines}{}
\let\coloredlines\gre@coloredlines
\def\grecoloredlines#1#2#3{%
	\PackageWarning{GregorioTeX}{\protect\grecoloredlines\space is deprecated.\MessageBreak  Use \protect\coloredlines\space instead}%
	\definecolor{gretempcolor}{RGB}{#1,#2,#3}%
	\gre@coloredlines{gretempcolor}%
}

\def\gre@redlines{%
  \gre@coloredlines{gregoriocolor}%
  \relax %
}
\newcommand*{\redlines}{}
\let\redlines\gre@redlines
\def\greredlines{%
	\PackageWarning{GregorioTeX}{\protect\greredlines\space is deprecated.\MessageBreak  Use \protect\redlines\space instead}%
	\gre@redlines
}

\def\gre@normallines{%
  \global\def\gre@stafflinesformat{}
  \relax %
}
\newcommand*{\normallines}{}
\let\normallines\gre@normallines
\def\grenormallines{%
	\PackageWarning{GregorioTeX}{\protect\grenormallines\space is deprecated.\MessageBreak  Use \protect\normallines\space instead}%
	\gre@normallines
}


%%%%%%%%%%%%%%
%	Formating aliases	%
%%%%%%%%%%%%%%

\def\greitalic#1{%
  \textit{#1}%
  \relax %
}

\def\gresmallcaps#1{%
  \textsc{#1}%
  \relax %
}
	
\def\greboldfont#1{%
  \textbf{#1}%
  \relax %
}

\def\grett#1{%
  \texttt{#1}%
  \relax %
}

\def\greul#1{%
  \underline{#1}%
  \relax %
}



% Apparently this was another alias for \setfirstannotation.  Possibly earlier.
\def\writemode#1{%
	\PackageWarning{GregorioTeX}{\protect\writemode\space is deprecated.\MessageBreak  Use \protect\setfirstannoation\space instead}%
	\gre@setfirstannotation{\textsc{\textbf{#1}}}%
  \relax %
}

% opening and closing of the aux file. We can't do it another way,
% because of the case of several scores.
\AtBeginDocument{\opengreaux }
\AtEndDocument{\closegreaux }
