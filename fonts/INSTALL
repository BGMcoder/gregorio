Fonts generation
================

Gregorio works with Omega, but for TeX compatibility of the fonts, they are divided in 255 character fonts.

If you are under debian or ubuntu, the best and most simple way to install the fonts is to build the package, with dpkg-buildpackage. You will need dpkg-dev. Just type dpkg-buildpackage in the root directory of the sources, it will tell you which packets to install, and will build you (in the parent directory) two .deb files: one containing the gregorio program (gregorio_x.y.z.deb) and the other containing the fonts (gregoriotex_x.y.z.deb). You'll just have to install the gregoriotex package to get the fonts installed and working. To install foo.deb, use dpkg -i foo.deb, with root privileges.

You can notice if you watch gregorio-base.sfd (sfd is the native fontforge format), that there are only a few glyphs. First you must combine them to get all the glyphs (more than 1000). It is made by a quite dirty trick: a python script (squarize.py) generates a fontforge script (squarize.pe) that generates six 255 character fonts containing all the glyphs of gregorian chant. It generates the fonts in pfb, afm, enc and tfm.

In the next steps, we create gregorio, but to create parmesan or greciliae, just replace "gregorio" by "parmesan" or "greciliae".

So for now the basic use is:

 python squarize.py
 fontforge -script gregorio.pe

The second step may take several minutes, even on a recent machine.

Then we must generate an ovp (the readable format of omega virtual font). To do so, we use the script create_font.pl. But this script needs the pl files corresponding to the tfm files of the fonts. So we must generate them with tftopl (included in TeXlive) :

 tftopl gregorio-0.tfm
 tftopl gregorio-1.tfm
 tftopl gregorio-2.tfm
 tftopl gregorio-3.tfm
 tftopl gregorio-4.tfm

and then we execute the script:

 perl create_font.pl

It generates the ovp file. We finally need to generate usable virtual fonts: ofm and ovf. They are both generated by ovp2ovf (also included in TeXlive):

 ovp2ovf gregorio.ovp

Font and TeX installation
=========================

The installation of the font depends on the system you have, that's why it is not done when you execute 'make install', but done when packaging into a .deb file (because all debians have the same system). Here is the procedure to install a font in debian/TeXlive, it may or may not be the same with you system, but you can certainly largely inspire from it.

First you need to copy the files at the good place. $(TEXMF) is almost all the time /usr/share/texmf

 # first we create global gregoriotex dirs:
 mkdir -p $(TEXMF)/fonts/tfm/public/gregoriotex
 mkdir -p $(TEXMF)/fonts/type1/public/gregoriotex
 mkdir -p $(TEXMF)/fonts/map/dvips/gregoriotex
 mkdir -p $(TEXMF)/fonts/ovf/public/gregoriotex
 mkdir -p $(TEXMF)/fonts/ofm/public/gregoriotex
 mkdir -p $(TEXMF)/fonts/ovp/public/gregoriotex
 mkdir -p $(TEXMF)/fonts/tfm/public/gregoriotex/greciliae
 cp greciliae*.tfm $(TEXMF)/fonts/tfm/gregoriotex/greciliae
 mkdir $(TEXMF)/fonts/type1/public/gregoriotex/greciliae
 cp greciliae*.pfb $(TEXMF)/fonts/type1/gregoriotex/greciliae
 mkdir $(TEXMF)/fonts/map/dvips/public/gregoriotex/greciliae
 cp greciliae.map $(TEXMF)/fonts/map/dvips/gregoriotex/greciliae
 mkdir $(TEXMF)/fonts/ovf/public/gregoriotex/greciliae
 cp greciliae.ovf $(TEXMF)/fonts/ovf/gregoriotex/greciliae
 mkdir $(TEXMF)/fonts/ofm/public/gregoriotex/greciliae
 cp greciliae.ofm $(TEXMF)/fonts/ofm/gregoriotex/greciliae
 mkdir $(TEXMF)/fonts/ovp/public/gregoriotex/greciliae
 cp greciliae.ovp $(TEXMF)/fonts/ovp/gregoriotex/greciliae
 # done for the font greciliae, now we install gregoriotex and gresym
 # you can repeat this step for the fonts gregorio and parmesan if you want to install them
 mkdir $(TEXMF)/tex/gregoriotex
 cp ../tex/gregorio.tex $(TEXMF)/tex/gregoriotex
 mkdir $(TEXMF)/fonts/tfm/public/gregoriotex/gresym
 cp gresym.tfm $(TEXMF)/fonts/tfm/gregoriotex/gresym
 mkdir $(TEXMF)/fonts/type1/public/gregoriotex/gresym
 cp gresym.pfb $(TEXMF)/fonts/type1/gregoriotex/gresym
 

If the directories are not the same (which is quite rare, you must change gregorio.map). Things are more complex when you deal with the maps:

 mkdir /usr/share/texmf/fonts/map/dvips/gregoriotex
 cp gregorio.map /usr/share/texmf/fonts/map/dvips/gregoriotex
 cp gresym.map /usr/share/texmf/fonts/map/dvips/gregoriotex

To know where to copy it, try locate .map. Then you must build a reference to that map in the updmap configuration:

 echo "MixedMap /usr/share/texmf/fonts/map/dvips/gregoriotex/greciliae.map" >>/etc/texmf/updmap.d/20gregoriotex.cfg
 
or on non-debian systems :

 echo "MixedMap /usr/share/texmf/fonts/map/dvips/gregoriotex/greciliae.map" >>/usr/share/texmf/web2c/updmap.cfg

and another reference to gresym:
 
 echo "MixedMap /usr/share/texmf/fonts/map/dvips/gregoriotex/gresym.map" >>/etc/texmf/updmap.d/20gregoriotex.cfg
 
or on non-debian systems :

 echo "MixedMap /usr/share/texmf/fonts/map/dvips/gregoriotex/gresym.map" >>/usr/share/texmf/web2c/updmap.cfg

Now we just have to run the programs to update tex (all must be executed with the root prvivileges):

 texhash
 mktexlsr
 update-updmap
 updmap-sys (or updmap)

Now you should be able to use gregoriotex.
